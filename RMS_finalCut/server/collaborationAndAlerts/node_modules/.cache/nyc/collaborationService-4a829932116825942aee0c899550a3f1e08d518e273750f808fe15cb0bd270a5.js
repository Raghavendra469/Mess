function cov_dfkd4bap8(){var path="C:\\presentaton\\RMS_finalCut\\server\\collaborationAndAlerts\\services\\collaborationService.js";var hash="f4135a7e879ba5d5ea3213c64b02c62d382af4b5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\presentaton\\RMS_finalCut\\server\\collaborationAndAlerts\\services\\collaborationService.js",statementMap:{"0":{start:{line:1,column:32},end:{line:1,column:82}},"1":{start:{line:5,column:8},end:{line:5,column:69}},"2":{start:{line:9,column:8},end:{line:9,column:89}},"3":{start:{line:13,column:8},end:{line:13,column:95}},"4":{start:{line:19,column:30},end:{line:19,column:103}},"5":{start:{line:20,column:8},end:{line:20,column:71}},"6":{start:{line:20,column:28},end:{line:20,column:71}},"7":{start:{line:22,column:8},end:{line:38,column:9}},"8":{start:{line:23,column:27},end:{line:23,column:49}},"9":{start:{line:26,column:10},end:{line:26,column:96}},"10":{start:{line:29,column:10},end:{line:29,column:108}},"11":{start:{line:32,column:10},end:{line:32,column:100}},"12":{start:{line:33,column:10},end:{line:33,column:91}},"13":{start:{line:37,column:10},end:{line:37,column:104}},"14":{start:{line:45,column:8},end:{line:45,column:107}},"15":{start:{line:49,column:8},end:{line:49,column:104}},"16":{start:{line:53,column:0},end:{line:53,column:38}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:4},end:{line:4,column:5}},loc:{start:{line:4,column:18},end:{line:6,column:5}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:4},end:{line:8,column:5}},loc:{start:{line:8,column:49},end:{line:10,column:5}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:4},end:{line:12,column:5}},loc:{start:{line:12,column:55},end:{line:14,column:5}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:17,column:4},end:{line:17,column:5}},loc:{start:{line:17,column:61},end:{line:41,column:7}},line:17},"4":{name:"(anonymous_4)",decl:{start:{line:44,column:4},end:{line:44,column:5}},loc:{start:{line:44,column:67},end:{line:46,column:5}},line:44},"5":{name:"(anonymous_5)",decl:{start:{line:48,column:4},end:{line:48,column:5}},loc:{start:{line:48,column:64},end:{line:50,column:5}},line:48}},branchMap:{"0":{loc:{start:{line:20,column:8},end:{line:20,column:71}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:71}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:20},"1":{loc:{start:{line:22,column:8},end:{line:38,column:9}},type:"if",locations:[{start:{line:22,column:8},end:{line:38,column:9}},{start:{line:34,column:15},end:{line:38,column:9}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f4135a7e879ba5d5ea3213c64b02c62d382af4b5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_dfkd4bap8=function(){return actualCoverage;};}return actualCoverage;}cov_dfkd4bap8();const CollaborationRepository=(cov_dfkd4bap8().s[0]++,require('../repositories/collaborationRepository'));class CollaborationService{constructor(){cov_dfkd4bap8().f[0]++;cov_dfkd4bap8().s[1]++;this.collaborationRepository=new CollaborationRepository();}async createCollaboration(collaborationData){cov_dfkd4bap8().f[1]++;cov_dfkd4bap8().s[2]++;return await this.collaborationRepository.createCollaboration(collaborationData);}async getCollaborationsByUserAndRole(userId,role){cov_dfkd4bap8().f[2]++;cov_dfkd4bap8().s[3]++;return await this.collaborationRepository.getCollaborationsByUserAndRole(userId,role);}async updateCollaborationStatus(collaborationId,status){cov_dfkd4bap8().f[3]++;const collaboration=(cov_dfkd4bap8().s[4]++,await this.collaborationRepository.findCollaborationById(collaborationId));cov_dfkd4bap8().s[5]++;if(!collaboration){cov_dfkd4bap8().b[0][0]++;cov_dfkd4bap8().s[6]++;throw new Error("Collaboration not found");}else{cov_dfkd4bap8().b[0][1]++;}cov_dfkd4bap8().s[7]++;if(status==="Approved"){cov_dfkd4bap8().b[1][0]++;const artistId=(cov_dfkd4bap8().s[8]++,collaboration.artistId);// Fetch artist's songs
cov_dfkd4bap8().s[9]++;await this.collaborationRepository.updateCollaborationStatus(collaborationId,status);// Update manager's managedArtists
cov_dfkd4bap8().s[10]++;await this.collaborationRepository.updateManagerManagedArtists(collaboration.managerId,artistId);// Update artist's manager reference
cov_dfkd4bap8().s[11]++;await this.collaborationRepository.updateArtistManager(artistId,collaboration.managerId);cov_dfkd4bap8().s[12]++;return await this.collaborationRepository.findCollaborationById(collaborationId);}else{cov_dfkd4bap8().b[1][1]++;cov_dfkd4bap8().s[13]++;// Just update status if not "Approved"
return await this.collaborationRepository.updateCollaborationStatus(collaborationId,status);}}async requestCancellation(collaborationId,cancellationReason){cov_dfkd4bap8().f[4]++;cov_dfkd4bap8().s[14]++;return await this.collaborationRepository.requestCancellation(collaborationId,cancellationReason);}async handleCancellationResponse(collaborationId,decision){cov_dfkd4bap8().f[5]++;cov_dfkd4bap8().s[15]++;return await this.collaborationRepository.handleCancellationResponse(collaborationId,decision);}}cov_dfkd4bap8().s[16]++;module.exports=CollaborationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfZGZrZDRiYXA4IiwiYWN0dWFsQ292ZXJhZ2UiLCJDb2xsYWJvcmF0aW9uUmVwb3NpdG9yeSIsInMiLCJyZXF1aXJlIiwiQ29sbGFib3JhdGlvblNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImYiLCJjb2xsYWJvcmF0aW9uUmVwb3NpdG9yeSIsImNyZWF0ZUNvbGxhYm9yYXRpb24iLCJjb2xsYWJvcmF0aW9uRGF0YSIsImdldENvbGxhYm9yYXRpb25zQnlVc2VyQW5kUm9sZSIsInVzZXJJZCIsInJvbGUiLCJ1cGRhdGVDb2xsYWJvcmF0aW9uU3RhdHVzIiwiY29sbGFib3JhdGlvbklkIiwic3RhdHVzIiwiY29sbGFib3JhdGlvbiIsImZpbmRDb2xsYWJvcmF0aW9uQnlJZCIsImIiLCJFcnJvciIsImFydGlzdElkIiwidXBkYXRlTWFuYWdlck1hbmFnZWRBcnRpc3RzIiwibWFuYWdlcklkIiwidXBkYXRlQXJ0aXN0TWFuYWdlciIsInJlcXVlc3RDYW5jZWxsYXRpb24iLCJjYW5jZWxsYXRpb25SZWFzb24iLCJoYW5kbGVDYW5jZWxsYXRpb25SZXNwb25zZSIsImRlY2lzaW9uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNvbGxhYm9yYXRpb25TZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENvbGxhYm9yYXRpb25SZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vcmVwb3NpdG9yaWVzL2NvbGxhYm9yYXRpb25SZXBvc2l0b3J5Jyk7XHJcbiBcclxuY2xhc3MgQ29sbGFib3JhdGlvblNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5jb2xsYWJvcmF0aW9uUmVwb3NpdG9yeSA9IG5ldyBDb2xsYWJvcmF0aW9uUmVwb3NpdG9yeSgpO1xyXG4gICAgfVxyXG4gXHJcbiAgICBhc3luYyBjcmVhdGVDb2xsYWJvcmF0aW9uKGNvbGxhYm9yYXRpb25EYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkuY3JlYXRlQ29sbGFib3JhdGlvbihjb2xsYWJvcmF0aW9uRGF0YSk7XHJcbiAgICB9XHJcbiBcclxuICAgIGFzeW5jIGdldENvbGxhYm9yYXRpb25zQnlVc2VyQW5kUm9sZSh1c2VySWQsIHJvbGUpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb2xsYWJvcmF0aW9uUmVwb3NpdG9yeS5nZXRDb2xsYWJvcmF0aW9uc0J5VXNlckFuZFJvbGUodXNlcklkLCByb2xlKTtcclxuICAgIH1cclxuIFxyXG5cclxuICAgIGFzeW5jIHVwZGF0ZUNvbGxhYm9yYXRpb25TdGF0dXMoY29sbGFib3JhdGlvbklkLCBzdGF0dXMpIHtcclxuICAgXHJcbiAgICAgICAgY29uc3QgY29sbGFib3JhdGlvbiA9IGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkuZmluZENvbGxhYm9yYXRpb25CeUlkKGNvbGxhYm9yYXRpb25JZCk7XHJcbiAgICAgICAgaWYgKCFjb2xsYWJvcmF0aW9uKSB0aHJvdyBuZXcgRXJyb3IoXCJDb2xsYWJvcmF0aW9uIG5vdCBmb3VuZFwiKTtcclxuICAgXHJcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gXCJBcHByb3ZlZFwiKSB7XHJcbiAgICAgICAgICBjb25zdCBhcnRpc3RJZCA9IGNvbGxhYm9yYXRpb24uYXJ0aXN0SWQ7XHJcbiAgICAgICAgICAvLyBGZXRjaCBhcnRpc3QncyBzb25nc1xyXG5cclxuICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkudXBkYXRlQ29sbGFib3JhdGlvblN0YXR1cyhjb2xsYWJvcmF0aW9uSWQsIHN0YXR1cyk7XHJcbiAgIFxyXG4gICAgICAgICAgLy8gVXBkYXRlIG1hbmFnZXIncyBtYW5hZ2VkQXJ0aXN0c1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5jb2xsYWJvcmF0aW9uUmVwb3NpdG9yeS51cGRhdGVNYW5hZ2VyTWFuYWdlZEFydGlzdHMoY29sbGFib3JhdGlvbi5tYW5hZ2VySWQsIGFydGlzdElkKTtcclxuICAgXHJcbiAgICAgICAgICAvLyBVcGRhdGUgYXJ0aXN0J3MgbWFuYWdlciByZWZlcmVuY2VcclxuICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkudXBkYXRlQXJ0aXN0TWFuYWdlcihhcnRpc3RJZCwgY29sbGFib3JhdGlvbi5tYW5hZ2VySWQpO1xyXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkuZmluZENvbGxhYm9yYXRpb25CeUlkKGNvbGxhYm9yYXRpb25JZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAvLyBKdXN0IHVwZGF0ZSBzdGF0dXMgaWYgbm90IFwiQXBwcm92ZWRcIlxyXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkudXBkYXRlQ29sbGFib3JhdGlvblN0YXR1cyhjb2xsYWJvcmF0aW9uSWQsIHN0YXR1cyApO1xyXG4gICAgICAgIH1cclxuICAgXHJcbiAgICAgICBcclxuICAgICAgfVxyXG4gICBcclxuIFxyXG4gICAgYXN5bmMgcmVxdWVzdENhbmNlbGxhdGlvbihjb2xsYWJvcmF0aW9uSWQsIGNhbmNlbGxhdGlvblJlYXNvbikge1xyXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LnJlcXVlc3RDYW5jZWxsYXRpb24oY29sbGFib3JhdGlvbklkLCBjYW5jZWxsYXRpb25SZWFzb24pO1xyXG4gICAgfVxyXG4gXHJcbiAgICBhc3luYyBoYW5kbGVDYW5jZWxsYXRpb25SZXNwb25zZShjb2xsYWJvcmF0aW9uSWQsIGRlY2lzaW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkuaGFuZGxlQ2FuY2VsbGF0aW9uUmVzcG9uc2UoY29sbGFib3JhdGlvbklkLCBkZWNpc2lvbik7XHJcbiAgICB9XHJcbn1cclxuIFxyXG5tb2R1bGUuZXhwb3J0cyA9IENvbGxhYm9yYXRpb25TZXJ2aWNlOyJdLCJtYXBwaW5ncyI6IjgvRkFlWTtBQUFBQSxhQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGFBQUEsR0FmWixLQUFNLENBQUFFLHVCQUF1QixFQUFBRixhQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHlDQUF5QyxDQUFDLEVBRWxGLEtBQU0sQ0FBQUMsb0JBQXFCLENBQ3ZCQyxXQUFXQSxDQUFBLENBQUcsQ0FBQU4sYUFBQSxHQUFBTyxDQUFBLE1BQUFQLGFBQUEsR0FBQUcsQ0FBQSxNQUNWLElBQUksQ0FBQ0ssdUJBQXVCLENBQUcsR0FBSSxDQUFBTix1QkFBdUIsQ0FBQyxDQUFDLENBQ2hFLENBRUEsS0FBTSxDQUFBTyxtQkFBbUJBLENBQUNDLGlCQUFpQixDQUFFLENBQUFWLGFBQUEsR0FBQU8sQ0FBQSxNQUFBUCxhQUFBLEdBQUFHLENBQUEsTUFDekMsTUFBTyxNQUFNLEtBQUksQ0FBQ0ssdUJBQXVCLENBQUNDLG1CQUFtQixDQUFDQyxpQkFBaUIsQ0FBQyxDQUNwRixDQUVBLEtBQU0sQ0FBQUMsOEJBQThCQSxDQUFDQyxNQUFNLENBQUVDLElBQUksQ0FBRSxDQUFBYixhQUFBLEdBQUFPLENBQUEsTUFBQVAsYUFBQSxHQUFBRyxDQUFBLE1BQy9DLE1BQU8sTUFBTSxLQUFJLENBQUNLLHVCQUF1QixDQUFDRyw4QkFBOEIsQ0FBQ0MsTUFBTSxDQUFFQyxJQUFJLENBQUMsQ0FDMUYsQ0FHQSxLQUFNLENBQUFDLHlCQUF5QkEsQ0FBQ0MsZUFBZSxDQUFFQyxNQUFNLENBQUUsQ0FBQWhCLGFBQUEsR0FBQU8sQ0FBQSxNQUVyRCxLQUFNLENBQUFVLGFBQWEsRUFBQWpCLGFBQUEsR0FBQUcsQ0FBQSxNQUFHLEtBQU0sS0FBSSxDQUFDSyx1QkFBdUIsQ0FBQ1UscUJBQXFCLENBQUNILGVBQWUsQ0FBQyxFQUFDZixhQUFBLEdBQUFHLENBQUEsTUFDaEcsR0FBSSxDQUFDYyxhQUFhLENBQUUsQ0FBQWpCLGFBQUEsR0FBQW1CLENBQUEsU0FBQW5CLGFBQUEsR0FBQUcsQ0FBQSxXQUFNLElBQUksQ0FBQWlCLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxFQUFDLEtBQUFwQixhQUFBLEdBQUFtQixDQUFBLFVBQUFuQixhQUFBLEdBQUFHLENBQUEsTUFFL0QsR0FBSWEsTUFBTSxHQUFLLFVBQVUsQ0FBRSxDQUFBaEIsYUFBQSxHQUFBbUIsQ0FBQSxTQUN6QixLQUFNLENBQUFFLFFBQVEsRUFBQXJCLGFBQUEsR0FBQUcsQ0FBQSxNQUFHYyxhQUFhLENBQUNJLFFBQVEsRUFDdkM7QUFBQXJCLGFBQUEsR0FBQUcsQ0FBQSxNQUVBLEtBQU0sS0FBSSxDQUFDSyx1QkFBdUIsQ0FBQ00seUJBQXlCLENBQUNDLGVBQWUsQ0FBRUMsTUFBTSxDQUFDLENBRXJGO0FBQUFoQixhQUFBLEdBQUFHLENBQUEsT0FDQSxLQUFNLEtBQUksQ0FBQ0ssdUJBQXVCLENBQUNjLDJCQUEyQixDQUFDTCxhQUFhLENBQUNNLFNBQVMsQ0FBRUYsUUFBUSxDQUFDLENBRWpHO0FBQUFyQixhQUFBLEdBQUFHLENBQUEsT0FDQSxLQUFNLEtBQUksQ0FBQ0ssdUJBQXVCLENBQUNnQixtQkFBbUIsQ0FBQ0gsUUFBUSxDQUFFSixhQUFhLENBQUNNLFNBQVMsQ0FBQyxDQUFDdkIsYUFBQSxHQUFBRyxDQUFBLE9BQzFGLE1BQU8sTUFBTSxLQUFJLENBQUNLLHVCQUF1QixDQUFDVSxxQkFBcUIsQ0FBQ0gsZUFBZSxDQUFDLENBQ2xGLENBQUMsSUFBTSxDQUFBZixhQUFBLEdBQUFtQixDQUFBLFNBQUFuQixhQUFBLEdBQUFHLENBQUEsT0FFTDtBQUNBLE1BQU8sTUFBTSxLQUFJLENBQUNLLHVCQUF1QixDQUFDTSx5QkFBeUIsQ0FBQ0MsZUFBZSxDQUFFQyxNQUFPLENBQUMsQ0FDL0YsQ0FHRixDQUdGLEtBQU0sQ0FBQVMsbUJBQW1CQSxDQUFDVixlQUFlLENBQUVXLGtCQUFrQixDQUFFLENBQUExQixhQUFBLEdBQUFPLENBQUEsTUFBQVAsYUFBQSxHQUFBRyxDQUFBLE9BQzNELE1BQU8sTUFBTSxLQUFJLENBQUNLLHVCQUF1QixDQUFDaUIsbUJBQW1CLENBQUNWLGVBQWUsQ0FBRVcsa0JBQWtCLENBQUMsQ0FDdEcsQ0FFQSxLQUFNLENBQUFDLDBCQUEwQkEsQ0FBQ1osZUFBZSxDQUFFYSxRQUFRLENBQUUsQ0FBQTVCLGFBQUEsR0FBQU8sQ0FBQSxNQUFBUCxhQUFBLEdBQUFHLENBQUEsT0FDeEQsTUFBTyxNQUFNLEtBQUksQ0FBQ0ssdUJBQXVCLENBQUNtQiwwQkFBMEIsQ0FBQ1osZUFBZSxDQUFFYSxRQUFRLENBQUMsQ0FDbkcsQ0FDSixDQUFDNUIsYUFBQSxHQUFBRyxDQUFBLE9BRUQwQixNQUFNLENBQUNDLE9BQU8sQ0FBR3pCLG9CQUFvQiIsImlnbm9yZUxpc3QiOltdfQ==