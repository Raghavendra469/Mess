function cov_2rgdiac1gc(){var path="C:\\final project all things done\\server\\userManagementModule\\services\\userService.js";var hash="90e2ede8e4c063db6a90625909d051e6338972f2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\final project all things done\\server\\userManagementModule\\services\\userService.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:32}},"1":{start:{line:2,column:23},end:{line:2,column:64}},"2":{start:{line:3,column:19},end:{line:3,column:40}},"3":{start:{line:7,column:4},end:{line:7,column:47}},"4":{start:{line:12,column:4},end:{line:32,column:5}},"5":{start:{line:13,column:26},end:{line:19,column:8}},"6":{start:{line:21,column:26},end:{line:26,column:7}},"7":{start:{line:28,column:6},end:{line:28,column:46}},"8":{start:{line:31,column:6},end:{line:31,column:51}},"9":{start:{line:37,column:34},end:{line:37,column:42}},"10":{start:{line:38,column:27},end:{line:38,column:58}},"11":{start:{line:39,column:39},end:{line:39,column:76}},"12":{start:{line:41,column:16},end:{line:41,column:80}},"13":{start:{line:46,column:4},end:{line:54,column:5}},"14":{start:{line:47,column:26},end:{line:47,column:109}},"15":{start:{line:48,column:6},end:{line:48,column:59}},"16":{start:{line:49,column:11},end:{line:54,column:5}},"17":{start:{line:51,column:25},end:{line:51,column:107}},"18":{start:{line:53,column:6},end:{line:53,column:57}},"19":{start:{line:55,column:4},end:{line:55,column:58}},"20":{start:{line:57,column:4},end:{line:57,column:19}},"21":{start:{line:62,column:17},end:{line:62,column:71}},"22":{start:{line:63,column:4},end:{line:65,column:5}},"23":{start:{line:64,column:6},end:{line:64,column:40}},"24":{start:{line:67,column:24},end:{line:67,column:92}},"25":{start:{line:68,column:4},end:{line:70,column:5}},"26":{start:{line:69,column:6},end:{line:69,column:56}},"27":{start:{line:72,column:4},end:{line:72,column:23}},"28":{start:{line:77,column:17},end:{line:77,column:71}},"29":{start:{line:78,column:4},end:{line:80,column:5}},"30":{start:{line:79,column:6},end:{line:79,column:40}},"31":{start:{line:82,column:27},end:{line:82,column:103}},"32":{start:{line:83,column:4},end:{line:85,column:5}},"33":{start:{line:84,column:6},end:{line:84,column:56}},"34":{start:{line:87,column:4},end:{line:87,column:26}},"35":{start:{line:92,column:17},end:{line:92,column:71}},"36":{start:{line:93,column:4},end:{line:95,column:5}},"37":{start:{line:94,column:6},end:{line:94,column:40}},"38":{start:{line:97,column:4},end:{line:97,column:62}},"39":{start:{line:98,column:4},end:{line:98,column:16}},"40":{start:{line:103,column:4},end:{line:103,column:61}},"41":{start:{line:107,column:17},end:{line:107,column:81}},"42":{start:{line:109,column:4},end:{line:111,column:5}},"43":{start:{line:110,column:6},end:{line:110,column:40}},"44":{start:{line:113,column:4},end:{line:113,column:16}},"45":{start:{line:118,column:0},end:{line:118,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:2},end:{line:6,column:3}},loc:{start:{line:6,column:16},end:{line:8,column:3}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:2},end:{line:11,column:3}},loc:{start:{line:11,column:35},end:{line:33,column:3}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:2},end:{line:35,column:3}},loc:{start:{line:35,column:29},end:{line:58,column:3}},line:35},"3":{name:"(anonymous_3)",decl:{start:{line:61,column:2},end:{line:61,column:3}},loc:{start:{line:61,column:43},end:{line:73,column:3}},line:61},"4":{name:"(anonymous_4)",decl:{start:{line:76,column:2},end:{line:76,column:3}},loc:{start:{line:76,column:48},end:{line:88,column:3}},line:76},"5":{name:"(anonymous_5)",decl:{start:{line:91,column:2},end:{line:91,column:3}},loc:{start:{line:91,column:29},end:{line:99,column:3}},line:91},"6":{name:"(anonymous_6)",decl:{start:{line:102,column:2},end:{line:102,column:3}},loc:{start:{line:102,column:26},end:{line:104,column:3}},line:102},"7":{name:"(anonymous_7)",decl:{start:{line:106,column:2},end:{line:106,column:3}},loc:{start:{line:106,column:43},end:{line:114,column:3}},line:106}},branchMap:{"0":{loc:{start:{line:46,column:4},end:{line:54,column:5}},type:"if",locations:[{start:{line:46,column:4},end:{line:54,column:5}},{start:{line:49,column:11},end:{line:54,column:5}}],line:46},"1":{loc:{start:{line:49,column:11},end:{line:54,column:5}},type:"if",locations:[{start:{line:49,column:11},end:{line:54,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:49},"2":{loc:{start:{line:63,column:4},end:{line:65,column:5}},type:"if",locations:[{start:{line:63,column:4},end:{line:65,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:63},"3":{loc:{start:{line:68,column:4},end:{line:70,column:5}},type:"if",locations:[{start:{line:68,column:4},end:{line:70,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:68},"4":{loc:{start:{line:78,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:78,column:4},end:{line:80,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:78},"5":{loc:{start:{line:83,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:85,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:83},"6":{loc:{start:{line:93,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:93,column:4},end:{line:95,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:93},"7":{loc:{start:{line:109,column:4},end:{line:111,column:5}},type:"if",locations:[{start:{line:109,column:4},end:{line:111,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:109}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"90e2ede8e4c063db6a90625909d051e6338972f2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2rgdiac1gc=function(){return actualCoverage;};}return actualCoverage;}cov_2rgdiac1gc();const bcrypt=(cov_2rgdiac1gc().s[0]++,require('bcrypt'));const UserRepository=(cov_2rgdiac1gc().s[1]++,require('../repositories/userRepository'));const nodemailer=(cov_2rgdiac1gc().s[2]++,require("nodemailer"));class UserService{constructor(){cov_2rgdiac1gc().f[0]++;cov_2rgdiac1gc().s[3]++;this.userRepository=new UserRepository();}async sendEmail(email,fullName){cov_2rgdiac1gc().f[1]++;cov_2rgdiac1gc().s[4]++;try{const transporter=(cov_2rgdiac1gc().s[5]++,nodemailer.createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}));const mailOptions=(cov_2rgdiac1gc().s[6]++,{from:process.env.EMAIL_USER,to:email,subject:"Account Created Successfully",text:`Hello ${fullName},\n\nYour account has been created successfully!\n\nEnter random password and login to change the password.\n\nBest Regards,\nRMS.`});cov_2rgdiac1gc().s[7]++;await transporter.sendMail(mailOptions);}catch(error){cov_2rgdiac1gc().s[8]++;console.error("Error sending email:",error);}}// Business logic for creating a user
async createUser(userData){cov_2rgdiac1gc().f[2]++;const{password,...rest}=(cov_2rgdiac1gc().s[9]++,userData);const hashedPassword=(cov_2rgdiac1gc().s[10]++,await bcrypt.hash(password,10));const userDataWithHashedPassword=(cov_2rgdiac1gc().s[11]++,{...rest,password:hashedPassword});let newUser=(cov_2rgdiac1gc().s[12]++,await this.userRepository.createUser(userDataWithHashedPassword));// Save to Manager or Artist collection based on role by calling repository methods
cov_2rgdiac1gc().s[13]++;if(newUser.role==='Manager'){cov_2rgdiac1gc().b[0][0]++;const managerData=(cov_2rgdiac1gc().s[14]++,{managerId:newUser._id,username:newUser.username,email:newUser.email,...rest});cov_2rgdiac1gc().s[15]++;await this.userRepository.createManager(managerData);}else{cov_2rgdiac1gc().b[0][1]++;cov_2rgdiac1gc().s[16]++;if(newUser.role==='Artist'){cov_2rgdiac1gc().b[1][0]++;const artistData=(cov_2rgdiac1gc().s[17]++,{artistId:newUser._id,username:newUser.username,email:newUser.email,...rest});cov_2rgdiac1gc().s[18]++;await this.userRepository.createArtist(artistData);}else{cov_2rgdiac1gc().b[1][1]++;}}cov_2rgdiac1gc().s[19]++;await this.sendEmail(newUser.email,newUser.username);cov_2rgdiac1gc().s[20]++;return newUser;}// Business logic for getting user profile
async getUserProfileByUsername(username){cov_2rgdiac1gc().f[3]++;const user=(cov_2rgdiac1gc().s[21]++,await this.userRepository.findUserByUsername(username));cov_2rgdiac1gc().s[22]++;if(!user){cov_2rgdiac1gc().b[2][0]++;cov_2rgdiac1gc().s[23]++;throw new Error('User not found');}else{cov_2rgdiac1gc().b[2][1]++;}const userProfile=(cov_2rgdiac1gc().s[24]++,await this.userRepository.findUserProfileByRole(user._id,user.role));cov_2rgdiac1gc().s[25]++;if(!userProfile){cov_2rgdiac1gc().b[3][0]++;cov_2rgdiac1gc().s[26]++;throw new Error(`${user.role} details not found`);}else{cov_2rgdiac1gc().b[3][1]++;}cov_2rgdiac1gc().s[27]++;return userProfile;}// Business logic for updating user details
async updateUserProfile(username,updateData){cov_2rgdiac1gc().f[4]++;const user=(cov_2rgdiac1gc().s[28]++,await this.userRepository.findUserByUsername(username));cov_2rgdiac1gc().s[29]++;if(!user){cov_2rgdiac1gc().b[4][0]++;cov_2rgdiac1gc().s[30]++;throw new Error('User not found');}else{cov_2rgdiac1gc().b[4][1]++;}const updatedProfile=(cov_2rgdiac1gc().s[31]++,await this.userRepository.updateUserProfile(user._id,user.role,updateData));cov_2rgdiac1gc().s[32]++;if(!updatedProfile){cov_2rgdiac1gc().b[5][0]++;cov_2rgdiac1gc().s[33]++;throw new Error(`${user.role} details not found`);}else{cov_2rgdiac1gc().b[5][1]++;}cov_2rgdiac1gc().s[34]++;return updatedProfile;}// Business logic for deleting a user
async deleteUser(username){cov_2rgdiac1gc().f[5]++;const user=(cov_2rgdiac1gc().s[35]++,await this.userRepository.findUserByUsername(username));cov_2rgdiac1gc().s[36]++;if(!user){cov_2rgdiac1gc().b[6][0]++;cov_2rgdiac1gc().s[37]++;throw new Error('User not found');}else{cov_2rgdiac1gc().b[6][1]++;}cov_2rgdiac1gc().s[38]++;await this.userRepository.deleteUser(user._id,user.role);cov_2rgdiac1gc().s[39]++;return true;}// Business logic for getting all users by role
async getAllUsers(role){cov_2rgdiac1gc().f[6]++;cov_2rgdiac1gc().s[40]++;return await this.userRepository.getAllUsersByRole(role);}async toggleUserStatus(userId,isActive){cov_2rgdiac1gc().f[7]++;const user=(cov_2rgdiac1gc().s[41]++,await this.userRepository.updateUserStatusById(userId,isActive));cov_2rgdiac1gc().s[42]++;if(!user){cov_2rgdiac1gc().b[7][0]++;cov_2rgdiac1gc().s[43]++;throw new Error('User not found');}else{cov_2rgdiac1gc().b[7][1]++;}cov_2rgdiac1gc().s[44]++;return user;}}cov_2rgdiac1gc().s[45]++;module.exports=UserService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMnJnZGlhYzFnYyIsImFjdHVhbENvdmVyYWdlIiwiYmNyeXB0IiwicyIsInJlcXVpcmUiLCJVc2VyUmVwb3NpdG9yeSIsIm5vZGVtYWlsZXIiLCJVc2VyU2VydmljZSIsImNvbnN0cnVjdG9yIiwiZiIsInVzZXJSZXBvc2l0b3J5Iiwic2VuZEVtYWlsIiwiZW1haWwiLCJmdWxsTmFtZSIsInRyYW5zcG9ydGVyIiwiY3JlYXRlVHJhbnNwb3J0Iiwic2VydmljZSIsImF1dGgiLCJ1c2VyIiwicHJvY2VzcyIsImVudiIsIkVNQUlMX1VTRVIiLCJwYXNzIiwiRU1BSUxfUEFTUyIsIm1haWxPcHRpb25zIiwiZnJvbSIsInRvIiwic3ViamVjdCIsInRleHQiLCJzZW5kTWFpbCIsImVycm9yIiwiY29uc29sZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsInBhc3N3b3JkIiwicmVzdCIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInVzZXJEYXRhV2l0aEhhc2hlZFBhc3N3b3JkIiwibmV3VXNlciIsInJvbGUiLCJiIiwibWFuYWdlckRhdGEiLCJtYW5hZ2VySWQiLCJfaWQiLCJ1c2VybmFtZSIsImNyZWF0ZU1hbmFnZXIiLCJhcnRpc3REYXRhIiwiYXJ0aXN0SWQiLCJjcmVhdGVBcnRpc3QiLCJnZXRVc2VyUHJvZmlsZUJ5VXNlcm5hbWUiLCJmaW5kVXNlckJ5VXNlcm5hbWUiLCJFcnJvciIsInVzZXJQcm9maWxlIiwiZmluZFVzZXJQcm9maWxlQnlSb2xlIiwidXBkYXRlVXNlclByb2ZpbGUiLCJ1cGRhdGVEYXRhIiwidXBkYXRlZFByb2ZpbGUiLCJkZWxldGVVc2VyIiwiZ2V0QWxsVXNlcnMiLCJnZXRBbGxVc2Vyc0J5Um9sZSIsInRvZ2dsZVVzZXJTdGF0dXMiLCJ1c2VySWQiLCJpc0FjdGl2ZSIsInVwZGF0ZVVzZXJTdGF0dXNCeUlkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZXJTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpO1xyXG5jb25zdCBVc2VyUmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL3JlcG9zaXRvcmllcy91c2VyUmVwb3NpdG9yeScpO1xyXG5jb25zdCBub2RlbWFpbGVyID0gcmVxdWlyZShcIm5vZGVtYWlsZXJcIik7XHJcbmNsYXNzIFVzZXJTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gbmV3IFVzZXJSZXBvc2l0b3J5KCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgYXN5bmMgc2VuZEVtYWlsKGVtYWlsLCBmdWxsTmFtZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XHJcbiAgICAgICAgc2VydmljZTogXCJnbWFpbFwiLFxyXG4gICAgICAgIGF1dGg6IHtcclxuICAgICAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkVNQUlMX1VTRVIsIFxyXG4gICAgICAgICAgcGFzczogcHJvY2Vzcy5lbnYuRU1BSUxfUEFTUywgXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICBmcm9tOiBwcm9jZXNzLmVudi5FTUFJTF9VU0VSLFxyXG4gICAgICAgIHRvOiBlbWFpbCxcclxuICAgICAgICBzdWJqZWN0OiBcIkFjY291bnQgQ3JlYXRlZCBTdWNjZXNzZnVsbHlcIixcclxuICAgICAgICB0ZXh0OiBgSGVsbG8gJHtmdWxsTmFtZX0sXFxuXFxuWW91ciBhY2NvdW50IGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVxcblxcbkVudGVyIHJhbmRvbSBwYXNzd29yZCBhbmQgbG9naW4gdG8gY2hhbmdlIHRoZSBwYXNzd29yZC5cXG5cXG5CZXN0IFJlZ2FyZHMsXFxuUk1TLmAsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucyk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgZW1haWw6XCIsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gQnVzaW5lc3MgbG9naWMgZm9yIGNyZWF0aW5nIGEgdXNlclxyXG4gIGFzeW5jIGNyZWF0ZVVzZXIodXNlckRhdGEpIHtcclxuICBcclxuICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnJlc3QgfSA9IHVzZXJEYXRhO1xyXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApO1xyXG4gICAgY29uc3QgdXNlckRhdGFXaXRoSGFzaGVkUGFzc3dvcmQgPSB7IC4uLnJlc3QsIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCB9O1xyXG5cclxuICAgIGxldCBuZXdVc2VyPWF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuY3JlYXRlVXNlcih1c2VyRGF0YVdpdGhIYXNoZWRQYXNzd29yZCk7XHJcbiBcclxuXHJcblxyXG4gICAgLy8gU2F2ZSB0byBNYW5hZ2VyIG9yIEFydGlzdCBjb2xsZWN0aW9uIGJhc2VkIG9uIHJvbGUgYnkgY2FsbGluZyByZXBvc2l0b3J5IG1ldGhvZHNcclxuICAgIGlmIChuZXdVc2VyLnJvbGUgPT09ICdNYW5hZ2VyJykge1xyXG4gICAgICBjb25zdCBtYW5hZ2VyRGF0YSA9IHsgbWFuYWdlcklkOiBuZXdVc2VyLl9pZCwgdXNlcm5hbWU6bmV3VXNlci51c2VybmFtZSwgZW1haWw6bmV3VXNlci5lbWFpbCwgLi4ucmVzdCB9O1xyXG4gICAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZU1hbmFnZXIobWFuYWdlckRhdGEpO1xyXG4gICAgfSBlbHNlIGlmIChuZXdVc2VyLnJvbGUgPT09ICdBcnRpc3QnKSB7XHJcbiAgXHJcbiAgICAgIGNvbnN0IGFydGlzdERhdGEgPSB7IGFydGlzdElkOiBuZXdVc2VyLl9pZCwgdXNlcm5hbWU6bmV3VXNlci51c2VybmFtZSwgZW1haWw6bmV3VXNlci5lbWFpbCwgLi4ucmVzdCB9O1xyXG4gICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZUFydGlzdChhcnRpc3REYXRhKTtcclxuICAgIH1cclxuICAgIGF3YWl0IHRoaXMuc2VuZEVtYWlsKG5ld1VzZXIuZW1haWwsIG5ld1VzZXIudXNlcm5hbWUpO1xyXG5cclxuICAgIHJldHVybiBuZXdVc2VyO1xyXG4gIH1cclxuXHJcbiAgLy8gQnVzaW5lc3MgbG9naWMgZm9yIGdldHRpbmcgdXNlciBwcm9maWxlXHJcbiAgYXN5bmMgZ2V0VXNlclByb2ZpbGVCeVVzZXJuYW1lKHVzZXJuYW1lKSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kVXNlckJ5VXNlcm5hbWUodXNlcm5hbWUpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyUHJvZmlsZSA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZFVzZXJQcm9maWxlQnlSb2xlKHVzZXIuX2lkLCB1c2VyLnJvbGUpO1xyXG4gICAgaWYgKCF1c2VyUHJvZmlsZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dXNlci5yb2xlfSBkZXRhaWxzIG5vdCBmb3VuZGApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1c2VyUHJvZmlsZTtcclxuICB9XHJcblxyXG4gIC8vIEJ1c2luZXNzIGxvZ2ljIGZvciB1cGRhdGluZyB1c2VyIGRldGFpbHNcclxuICBhc3luYyB1cGRhdGVVc2VyUHJvZmlsZSh1c2VybmFtZSwgdXBkYXRlRGF0YSkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZFVzZXJCeVVzZXJuYW1lKHVzZXJuYW1lKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlZFByb2ZpbGUgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LnVwZGF0ZVVzZXJQcm9maWxlKHVzZXIuX2lkLCB1c2VyLnJvbGUsIHVwZGF0ZURhdGEpO1xyXG4gICAgaWYgKCF1cGRhdGVkUHJvZmlsZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dXNlci5yb2xlfSBkZXRhaWxzIG5vdCBmb3VuZGApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1cGRhdGVkUHJvZmlsZTtcclxuICB9XHJcblxyXG4gIC8vIEJ1c2luZXNzIGxvZ2ljIGZvciBkZWxldGluZyBhIHVzZXJcclxuICBhc3luYyBkZWxldGVVc2VyKHVzZXJuYW1lKSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kVXNlckJ5VXNlcm5hbWUodXNlcm5hbWUpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmRlbGV0ZVVzZXIodXNlci5faWQsIHVzZXIucm9sZSk7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vIEJ1c2luZXNzIGxvZ2ljIGZvciBnZXR0aW5nIGFsbCB1c2VycyBieSByb2xlXHJcbiAgYXN5bmMgZ2V0QWxsVXNlcnMocm9sZSkge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZ2V0QWxsVXNlcnNCeVJvbGUocm9sZSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyB0b2dnbGVVc2VyU3RhdHVzKHVzZXJJZCwgaXNBY3RpdmUpIHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LnVwZGF0ZVVzZXJTdGF0dXNCeUlkKHVzZXJJZCwgaXNBY3RpdmUpO1xyXG4gICAgXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1c2VyO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVXNlclNlcnZpY2U7XHJcbiJdLCJtYXBwaW5ncyI6Iis3TUFlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWixLQUFNLENBQUFFLE1BQU0sRUFBQUYsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFDaEMsS0FBTSxDQUFBQyxjQUFjLEVBQUFMLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsZ0NBQWdDLENBQUMsRUFDaEUsS0FBTSxDQUFBRSxVQUFVLEVBQUFOLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQ3hDLEtBQU0sQ0FBQUcsV0FBWSxDQUVoQkMsV0FBV0EsQ0FBQSxDQUFHLENBQUFSLGNBQUEsR0FBQVMsQ0FBQSxNQUFBVCxjQUFBLEdBQUFHLENBQUEsTUFDWixJQUFJLENBQUNPLGNBQWMsQ0FBRyxHQUFJLENBQUFMLGNBQWMsQ0FBQyxDQUFDLENBQzVDLENBR0EsS0FBTSxDQUFBTSxTQUFTQSxDQUFDQyxLQUFLLENBQUVDLFFBQVEsQ0FBRSxDQUFBYixjQUFBLEdBQUFTLENBQUEsTUFBQVQsY0FBQSxHQUFBRyxDQUFBLE1BQy9CLEdBQUksQ0FDRixLQUFNLENBQUFXLFdBQVcsRUFBQWQsY0FBQSxHQUFBRyxDQUFBLE1BQUdHLFVBQVUsQ0FBQ1MsZUFBZSxDQUFDLENBQzdDQyxPQUFPLENBQUUsT0FBTyxDQUNoQkMsSUFBSSxDQUFFLENBQ0pDLElBQUksQ0FB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