function cov_209g4wi2ac(){var path="C:\\final project all things done\\server\\collaborationAndAlerts\\services\\collaborationService.js";var hash="e8d5a4c02cc7287efb376e52a6573bd021b39512";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\final project all things done\\server\\collaborationAndAlerts\\services\\collaborationService.js",statementMap:{"0":{start:{line:1,column:32},end:{line:1,column:82}},"1":{start:{line:5,column:8},end:{line:5,column:69}},"2":{start:{line:9,column:8},end:{line:9,column:89}},"3":{start:{line:13,column:8},end:{line:13,column:95}},"4":{start:{line:19,column:30},end:{line:19,column:103}},"5":{start:{line:20,column:8},end:{line:20,column:71}},"6":{start:{line:20,column:28},end:{line:20,column:71}},"7":{start:{line:22,column:8},end:{line:37,column:9}},"8":{start:{line:23,column:27},end:{line:23,column:49}},"9":{start:{line:26,column:10},end:{line:26,column:96}},"10":{start:{line:29,column:10},end:{line:29,column:108}},"11":{start:{line:32,column:10},end:{line:32,column:100}},"12":{start:{line:36,column:10},end:{line:36,column:100}},"13":{start:{line:39,column:8},end:{line:39,column:89}},"14":{start:{line:44,column:8},end:{line:44,column:107}},"15":{start:{line:48,column:8},end:{line:48,column:104}},"16":{start:{line:52,column:0},end:{line:52,column:38}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:4},end:{line:4,column:5}},loc:{start:{line:4,column:18},end:{line:6,column:5}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:4},end:{line:8,column:5}},loc:{start:{line:8,column:49},end:{line:10,column:5}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:4},end:{line:12,column:5}},loc:{start:{line:12,column:55},end:{line:14,column:5}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:17,column:4},end:{line:17,column:5}},loc:{start:{line:17,column:61},end:{line:40,column:7}},line:17},"4":{name:"(anonymous_4)",decl:{start:{line:43,column:4},end:{line:43,column:5}},loc:{start:{line:43,column:67},end:{line:45,column:5}},line:43},"5":{name:"(anonymous_5)",decl:{start:{line:47,column:4},end:{line:47,column:5}},loc:{start:{line:47,column:64},end:{line:49,column:5}},line:47}},branchMap:{"0":{loc:{start:{line:20,column:8},end:{line:20,column:71}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:71}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:20},"1":{loc:{start:{line:22,column:8},end:{line:37,column:9}},type:"if",locations:[{start:{line:22,column:8},end:{line:37,column:9}},{start:{line:33,column:15},end:{line:37,column:9}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e8d5a4c02cc7287efb376e52a6573bd021b39512"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_209g4wi2ac=function(){return actualCoverage;};}return actualCoverage;}cov_209g4wi2ac();const CollaborationRepository=(cov_209g4wi2ac().s[0]++,require('../repositories/collaborationRepository'));class CollaborationService{constructor(){cov_209g4wi2ac().f[0]++;cov_209g4wi2ac().s[1]++;this.collaborationRepository=new CollaborationRepository();}async createCollaboration(collaborationData){cov_209g4wi2ac().f[1]++;cov_209g4wi2ac().s[2]++;return await this.collaborationRepository.createCollaboration(collaborationData);}async getCollaborationsByUserAndRole(userId,role){cov_209g4wi2ac().f[2]++;cov_209g4wi2ac().s[3]++;return await this.collaborationRepository.getCollaborationsByUserAndRole(userId,role);}async updateCollaborationStatus(collaborationId,status){cov_209g4wi2ac().f[3]++;const collaboration=(cov_209g4wi2ac().s[4]++,await this.collaborationRepository.findCollaborationById(collaborationId));cov_209g4wi2ac().s[5]++;if(!collaboration){cov_209g4wi2ac().b[0][0]++;cov_209g4wi2ac().s[6]++;throw new Error("Collaboration not found");}else{cov_209g4wi2ac().b[0][1]++;}cov_209g4wi2ac().s[7]++;if(status==="Approved"){cov_209g4wi2ac().b[1][0]++;const artistId=(cov_209g4wi2ac().s[8]++,collaboration.artistId);// Fetch artist's songs
cov_209g4wi2ac().s[9]++;await this.collaborationRepository.updateCollaborationStatus(collaborationId,status);// Update manager's managedArtists
cov_209g4wi2ac().s[10]++;await this.collaborationRepository.updateManagerManagedArtists(collaboration.managerId,artistId);// Update artist's manager reference
cov_209g4wi2ac().s[11]++;await this.collaborationRepository.updateArtistManager(artistId,collaboration.managerId);}else{cov_209g4wi2ac().b[1][1]++;cov_209g4wi2ac().s[12]++;// Just update status if not "Approved"
await this.collaborationRepository.updateCollaborationStatus(collaborationId,{status});}cov_209g4wi2ac().s[13]++;return await this.collaborationRepository.findCollaborationById(collaborationId);}async requestCancellation(collaborationId,cancellationReason){cov_209g4wi2ac().f[4]++;cov_209g4wi2ac().s[14]++;return await this.collaborationRepository.requestCancellation(collaborationId,cancellationReason);}async handleCancellationResponse(collaborationId,decision){cov_209g4wi2ac().f[5]++;cov_209g4wi2ac().s[15]++;return await this.collaborationRepository.handleCancellationResponse(collaborationId,decision);}}cov_209g4wi2ac().s[16]++;module.exports=CollaborationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjA5ZzR3aTJhYyIsImFjdHVhbENvdmVyYWdlIiwiQ29sbGFib3JhdGlvblJlcG9zaXRvcnkiLCJzIiwicmVxdWlyZSIsIkNvbGxhYm9yYXRpb25TZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJmIiwiY29sbGFib3JhdGlvblJlcG9zaXRvcnkiLCJjcmVhdGVDb2xsYWJvcmF0aW9uIiwiY29sbGFib3JhdGlvbkRhdGEiLCJnZXRDb2xsYWJvcmF0aW9uc0J5VXNlckFuZFJvbGUiLCJ1c2VySWQiLCJyb2xlIiwidXBkYXRlQ29sbGFib3JhdGlvblN0YXR1cyIsImNvbGxhYm9yYXRpb25JZCIsInN0YXR1cyIsImNvbGxhYm9yYXRpb24iLCJmaW5kQ29sbGFib3JhdGlvbkJ5SWQiLCJiIiwiRXJyb3IiLCJhcnRpc3RJZCIsInVwZGF0ZU1hbmFnZXJNYW5hZ2VkQXJ0aXN0cyIsIm1hbmFnZXJJZCIsInVwZGF0ZUFydGlzdE1hbmFnZXIiLCJyZXF1ZXN0Q2FuY2VsbGF0aW9uIiwiY2FuY2VsbGF0aW9uUmVhc29uIiwiaGFuZGxlQ2FuY2VsbGF0aW9uUmVzcG9uc2UiLCJkZWNpc2lvbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJjb2xsYWJvcmF0aW9uU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBDb2xsYWJvcmF0aW9uUmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL3JlcG9zaXRvcmllcy9jb2xsYWJvcmF0aW9uUmVwb3NpdG9yeScpO1xyXG4gXHJcbmNsYXNzIENvbGxhYm9yYXRpb25TZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkgPSBuZXcgQ29sbGFib3JhdGlvblJlcG9zaXRvcnkoKTtcclxuICAgIH1cclxuIFxyXG4gICAgYXN5bmMgY3JlYXRlQ29sbGFib3JhdGlvbihjb2xsYWJvcmF0aW9uRGF0YSkge1xyXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LmNyZWF0ZUNvbGxhYm9yYXRpb24oY29sbGFib3JhdGlvbkRhdGEpO1xyXG4gICAgfVxyXG4gXHJcbiAgICBhc3luYyBnZXRDb2xsYWJvcmF0aW9uc0J5VXNlckFuZFJvbGUodXNlcklkLCByb2xlKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkuZ2V0Q29sbGFib3JhdGlvbnNCeVVzZXJBbmRSb2xlKHVzZXJJZCwgcm9sZSk7XHJcbiAgICB9XHJcbiBcclxuXHJcbiAgICBhc3luYyB1cGRhdGVDb2xsYWJvcmF0aW9uU3RhdHVzKGNvbGxhYm9yYXRpb25JZCwgc3RhdHVzKSB7XHJcbiAgIFxyXG4gICAgICAgIGNvbnN0IGNvbGxhYm9yYXRpb24gPSBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LmZpbmRDb2xsYWJvcmF0aW9uQnlJZChjb2xsYWJvcmF0aW9uSWQpO1xyXG4gICAgICAgIGlmICghY29sbGFib3JhdGlvbikgdGhyb3cgbmV3IEVycm9yKFwiQ29sbGFib3JhdGlvbiBub3QgZm91bmRcIik7XHJcbiAgIFxyXG4gICAgICAgIGlmIChzdGF0dXMgPT09IFwiQXBwcm92ZWRcIikge1xyXG4gICAgICAgICAgY29uc3QgYXJ0aXN0SWQgPSBjb2xsYWJvcmF0aW9uLmFydGlzdElkO1xyXG4gICAgICAgICAgLy8gRmV0Y2ggYXJ0aXN0J3Mgc29uZ3NcclxuXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LnVwZGF0ZUNvbGxhYm9yYXRpb25TdGF0dXMoY29sbGFib3JhdGlvbklkLCBzdGF0dXMpO1xyXG4gICBcclxuICAgICAgICAgIC8vIFVwZGF0ZSBtYW5hZ2VyJ3MgbWFuYWdlZEFydGlzdHNcclxuICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkudXBkYXRlTWFuYWdlck1hbmFnZWRBcnRpc3RzKGNvbGxhYm9yYXRpb24ubWFuYWdlcklkLCBhcnRpc3RJZCk7XHJcbiAgIFxyXG4gICAgICAgICAgLy8gVXBkYXRlIGFydGlzdCdzIG1hbmFnZXIgcmVmZXJlbmNlXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LnVwZGF0ZUFydGlzdE1hbmFnZXIoYXJ0aXN0SWQsIGNvbGxhYm9yYXRpb24ubWFuYWdlcklkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIC8vIEp1c3QgdXBkYXRlIHN0YXR1cyBpZiBub3QgXCJBcHByb3ZlZFwiXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LnVwZGF0ZUNvbGxhYm9yYXRpb25TdGF0dXMoY29sbGFib3JhdGlvbklkLCB7IHN0YXR1cyB9KTtcclxuICAgICAgICB9XHJcbiAgIFxyXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbGxhYm9yYXRpb25SZXBvc2l0b3J5LmZpbmRDb2xsYWJvcmF0aW9uQnlJZChjb2xsYWJvcmF0aW9uSWQpO1xyXG4gICAgICB9XHJcbiAgIFxyXG4gXHJcbiAgICBhc3luYyByZXF1ZXN0Q2FuY2VsbGF0aW9uKGNvbGxhYm9yYXRpb25JZCwgY2FuY2VsbGF0aW9uUmVhc29uKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29sbGFib3JhdGlvblJlcG9zaXRvcnkucmVxdWVzdENhbmNlbGxhdGlvbihjb2xsYWJvcmF0aW9uSWQsIGNhbmNlbGxhdGlvblJlYXNvbik7XHJcbiAgICB9XHJcbiBcclxuICAgIGFzeW5jIGhhbmRsZUNhbmNlbGxhdGlvblJlc3BvbnNlKGNvbGxhYm9yYXRpb25JZCwgZGVjaXNpb24pIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb2xsYWJvcmF0aW9uUmVwb3NpdG9yeS5oYW5kbGVDYW5jZWxsYXRpb25SZXNwb25zZShjb2xsYWJvcmF0aW9uSWQsIGRlY2lzaW9uKTtcclxuICAgIH1cclxu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