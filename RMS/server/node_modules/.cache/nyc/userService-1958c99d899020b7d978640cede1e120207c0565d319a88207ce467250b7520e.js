function cov_1yxzm004q2(){var path="C:\\capstone on friday\\Mess\\RMS\\server\\services\\userService.js";var hash="bb2e79d6b69bdcf970fd5186824c6ac27d3307c5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\capstone on friday\\Mess\\RMS\\server\\services\\userService.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:32}},"1":{start:{line:2,column:23},end:{line:2,column:64}},"2":{start:{line:3,column:19},end:{line:3,column:40}},"3":{start:{line:7,column:4},end:{line:7,column:47}},"4":{start:{line:12,column:4},end:{line:33,column:5}},"5":{start:{line:13,column:26},end:{line:19,column:8}},"6":{start:{line:21,column:26},end:{line:26,column:7}},"7":{start:{line:28,column:6},end:{line:28,column:46}},"8":{start:{line:29,column:6},end:{line:29,column:45}},"9":{start:{line:32,column:6},end:{line:32,column:51}},"10":{start:{line:38,column:34},end:{line:38,column:42}},"11":{start:{line:39,column:27},end:{line:39,column:58}},"12":{start:{line:40,column:39},end:{line:40,column:76}},"13":{start:{line:42,column:16},end:{line:42,column:80}},"14":{start:{line:47,column:4},end:{line:55,column:5}},"15":{start:{line:48,column:26},end:{line:48,column:109}},"16":{start:{line:49,column:6},end:{line:49,column:59}},"17":{start:{line:50,column:11},end:{line:55,column:5}},"18":{start:{line:52,column:25},end:{line:52,column:107}},"19":{start:{line:54,column:6},end:{line:54,column:57}},"20":{start:{line:56,column:4},end:{line:56,column:58}},"21":{start:{line:58,column:4},end:{line:58,column:19}},"22":{start:{line:63,column:4},end:{line:63,column:85}},"23":{start:{line:64,column:17},end:{line:64,column:71}},"24":{start:{line:65,column:4},end:{line:67,column:5}},"25":{start:{line:66,column:6},end:{line:66,column:40}},"26":{start:{line:69,column:24},end:{line:69,column:92}},"27":{start:{line:70,column:4},end:{line:72,column:5}},"28":{start:{line:71,column:6},end:{line:71,column:56}},"29":{start:{line:74,column:4},end:{line:74,column:23}},"30":{start:{line:79,column:17},end:{line:79,column:71}},"31":{start:{line:80,column:4},end:{line:82,column:5}},"32":{start:{line:81,column:6},end:{line:81,column:40}},"33":{start:{line:84,column:27},end:{line:84,column:103}},"34":{start:{line:85,column:4},end:{line:87,column:5}},"35":{start:{line:86,column:6},end:{line:86,column:56}},"36":{start:{line:89,column:4},end:{line:89,column:26}},"37":{start:{line:94,column:17},end:{line:94,column:71}},"38":{start:{line:95,column:4},end:{line:97,column:5}},"39":{start:{line:96,column:6},end:{line:96,column:40}},"40":{start:{line:99,column:4},end:{line:99,column:62}},"41":{start:{line:100,column:4},end:{line:100,column:16}},"42":{start:{line:105,column:4},end:{line:105,column:61}},"43":{start:{line:109,column:17},end:{line:109,column:81}},"44":{start:{line:111,column:4},end:{line:113,column:5}},"45":{start:{line:112,column:6},end:{line:112,column:40}},"46":{start:{line:115,column:4},end:{line:115,column:16}},"47":{start:{line:120,column:0},end:{line:120,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:2},end:{line:6,column:3}},loc:{start:{line:6,column:16},end:{line:8,column:3}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:2},end:{line:11,column:3}},loc:{start:{line:11,column:35},end:{line:34,column:3}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:36,column:2},end:{line:36,column:3}},loc:{start:{line:36,column:29},end:{line:59,column:3}},line:36},"3":{name:"(anonymous_3)",decl:{start:{line:62,column:2},end:{line:62,column:3}},loc:{start:{line:62,column:43},end:{line:75,column:3}},line:62},"4":{name:"(anonymous_4)",decl:{start:{line:78,column:2},end:{line:78,column:3}},loc:{start:{line:78,column:48},end:{line:90,column:3}},line:78},"5":{name:"(anonymous_5)",decl:{start:{line:93,column:2},end:{line:93,column:3}},loc:{start:{line:93,column:29},end:{line:101,column:3}},line:93},"6":{name:"(anonymous_6)",decl:{start:{line:104,column:2},end:{line:104,column:3}},loc:{start:{line:104,column:26},end:{line:106,column:3}},line:104},"7":{name:"(anonymous_7)",decl:{start:{line:108,column:2},end:{line:108,column:3}},loc:{start:{line:108,column:43},end:{line:116,column:3}},line:108}},branchMap:{"0":{loc:{start:{line:47,column:4},end:{line:55,column:5}},type:"if",locations:[{start:{line:47,column:4},end:{line:55,column:5}},{start:{line:50,column:11},end:{line:55,column:5}}],line:47},"1":{loc:{start:{line:50,column:11},end:{line:55,column:5}},type:"if",locations:[{start:{line:50,column:11},end:{line:55,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:50},"2":{loc:{start:{line:65,column:4},end:{line:67,column:5}},type:"if",locations:[{start:{line:65,column:4},end:{line:67,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:65},"3":{loc:{start:{line:70,column:4},end:{line:72,column:5}},type:"if",locations:[{start:{line:70,column:4},end:{line:72,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:70},"4":{loc:{start:{line:80,column:4},end:{line:82,column:5}},type:"if",locations:[{start:{line:80,column:4},end:{line:82,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:80},"5":{loc:{start:{line:85,column:4},end:{line:87,column:5}},type:"if",locations:[{start:{line:85,column:4},end:{line:87,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:85},"6":{loc:{start:{line:95,column:4},end:{line:97,column:5}},type:"if",locations:[{start:{line:95,column:4},end:{line:97,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:95},"7":{loc:{start:{line:111,column:4},end:{line:113,column:5}},type:"if",locations:[{start:{line:111,column:4},end:{line:113,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:111}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bb2e79d6b69bdcf970fd5186824c6ac27d3307c5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1yxzm004q2=function(){return actualCoverage;};}return actualCoverage;}cov_1yxzm004q2();const bcrypt=(cov_1yxzm004q2().s[0]++,require('bcrypt'));const UserRepository=(cov_1yxzm004q2().s[1]++,require('../repositories/userRepository'));const nodemailer=(cov_1yxzm004q2().s[2]++,require("nodemailer"));class UserService{constructor(){cov_1yxzm004q2().f[0]++;cov_1yxzm004q2().s[3]++;this.userRepository=new UserRepository();}async sendEmail(email,fullName){cov_1yxzm004q2().f[1]++;cov_1yxzm004q2().s[4]++;try{const transporter=(cov_1yxzm004q2().s[5]++,nodemailer.createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}));const mailOptions=(cov_1yxzm004q2().s[6]++,{from:process.env.EMAIL_USER,to:email,subject:"Account Created Successfully",text:`Hello ${fullName},\n\nYour account has been created successfully!\n\nEnter random password and login to change the password.\n\nBest Regards,\nRMS.`});cov_1yxzm004q2().s[7]++;await transporter.sendMail(mailOptions);cov_1yxzm004q2().s[8]++;console.log("Email sent successfully");}catch(error){cov_1yxzm004q2().s[9]++;console.error("Error sending email:",error);}}// Business logic for creating a user
async createUser(userData){cov_1yxzm004q2().f[2]++;const{password,...rest}=(cov_1yxzm004q2().s[10]++,userData);const hashedPassword=(cov_1yxzm004q2().s[11]++,await bcrypt.hash(password,10));const userDataWithHashedPassword=(cov_1yxzm004q2().s[12]++,{...rest,password:hashedPassword});let newUser=(cov_1yxzm004q2().s[13]++,await this.userRepository.createUser(userDataWithHashedPassword));// Save to Manager or Artist collection based on role by calling repository methods
cov_1yxzm004q2().s[14]++;if(newUser.role==='Manager'){cov_1yxzm004q2().b[0][0]++;const managerData=(cov_1yxzm004q2().s[15]++,{managerId:newUser._id,username:newUser.username,email:newUser.email,...rest});cov_1yxzm004q2().s[16]++;await this.userRepository.createManager(managerData);}else{cov_1yxzm004q2().b[0][1]++;cov_1yxzm004q2().s[17]++;if(newUser.role==='Artist'){cov_1yxzm004q2().b[1][0]++;const artistData=(cov_1yxzm004q2().s[18]++,{artistId:newUser._id,username:newUser.username,email:newUser.email,...rest});cov_1yxzm004q2().s[19]++;await this.userRepository.createArtist(artistData);}else{cov_1yxzm004q2().b[1][1]++;}}cov_1yxzm004q2().s[20]++;await this.sendEmail(newUser.email,newUser.username);cov_1yxzm004q2().s[21]++;return newUser;}// Business logic for getting user profile
async getUserProfileByUsername(username){cov_1yxzm004q2().f[3]++;cov_1yxzm004q2().s[22]++;console.log(username,"inside userService!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");const user=(cov_1yxzm004q2().s[23]++,await this.userRepository.findUserByUsername(username));cov_1yxzm004q2().s[24]++;if(!user){cov_1yxzm004q2().b[2][0]++;cov_1yxzm004q2().s[25]++;throw new Error('User not found');}else{cov_1yxzm004q2().b[2][1]++;}const userProfile=(cov_1yxzm004q2().s[26]++,await this.userRepository.findUserProfileByRole(user._id,user.role));cov_1yxzm004q2().s[27]++;if(!userProfile){cov_1yxzm004q2().b[3][0]++;cov_1yxzm004q2().s[28]++;throw new Error(`${user.role} details not found`);}else{cov_1yxzm004q2().b[3][1]++;}cov_1yxzm004q2().s[29]++;return userProfile;}// Business logic for updating user details
async updateUserProfile(username,updateData){cov_1yxzm004q2().f[4]++;const user=(cov_1yxzm004q2().s[30]++,await this.userRepository.findUserByUsername(username));cov_1yxzm004q2().s[31]++;if(!user){cov_1yxzm004q2().b[4][0]++;cov_1yxzm004q2().s[32]++;throw new Error('User not found');}else{cov_1yxzm004q2().b[4][1]++;}const updatedProfile=(cov_1yxzm004q2().s[33]++,await this.userRepository.updateUserProfile(user._id,user.role,updateData));cov_1yxzm004q2().s[34]++;if(!updatedProfile){cov_1yxzm004q2().b[5][0]++;cov_1yxzm004q2().s[35]++;throw new Error(`${user.role} details not found`);}else{cov_1yxzm004q2().b[5][1]++;}cov_1yxzm004q2().s[36]++;return updatedProfile;}// Business logic for deleting a user
async deleteUser(username){cov_1yxzm004q2().f[5]++;const user=(cov_1yxzm004q2().s[37]++,await this.userRepository.findUserByUsername(username));cov_1yxzm004q2().s[38]++;if(!user){cov_1yxzm004q2().b[6][0]++;cov_1yxzm004q2().s[39]++;throw new Error('User not found');}else{cov_1yxzm004q2().b[6][1]++;}cov_1yxzm004q2().s[40]++;await this.userRepository.deleteUser(user._id,user.role);cov_1yxzm004q2().s[41]++;return true;}// Business logic for getting all users by role
async getAllUsers(role){cov_1yxzm004q2().f[6]++;cov_1yxzm004q2().s[42]++;return await this.userRepository.getAllUsersByRole(role);}async toggleUserStatus(userId,isActive){cov_1yxzm004q2().f[7]++;const user=(cov_1yxzm004q2().s[43]++,await this.userRepository.updateUserStatusById(userId,isActive));cov_1yxzm004q2().s[44]++;if(!user){cov_1yxzm004q2().b[7][0]++;cov_1yxzm004q2().s[45]++;throw new Error('User not found');}else{cov_1yxzm004q2().b[7][1]++;}cov_1yxzm004q2().s[46]++;return user;}}cov_1yxzm004q2().s[47]++;module.exports=UserService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXl4em0wMDRxMiIsImFjdHVhbENvdmVyYWdlIiwiYmNyeXB0IiwicyIsInJlcXVpcmUiLCJVc2VyUmVwb3NpdG9yeSIsIm5vZGVtYWlsZXIiLCJVc2VyU2VydmljZSIsImNvbnN0cnVjdG9yIiwiZiIsInVzZXJSZXBvc2l0b3J5Iiwic2VuZEVtYWlsIiwiZW1haWwiLCJmdWxsTmFtZSIsInRyYW5zcG9ydGVyIiwiY3JlYXRlVHJhbnNwb3J0Iiwic2VydmljZSIsImF1dGgiLCJ1c2VyIiwicHJvY2VzcyIsImVudiIsIkVNQUlMX1VTRVIiLCJwYXNzIiwiRU1BSUxfUEFTUyIsIm1haWxPcHRpb25zIiwiZnJvbSIsInRvIiwic3ViamVjdCIsInRleHQiLCJzZW5kTWFpbCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsInBhc3N3b3JkIiwicmVzdCIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsInVzZXJEYXRhV2l0aEhhc2hlZFBhc3N3b3JkIiwibmV3VXNlciIsInJvbGUiLCJiIiwibWFuYWdlckRhdGEiLCJtYW5hZ2VySWQiLCJfaWQiLCJ1c2VybmFtZSIsImNyZWF0ZU1hbmFnZXIiLCJhcnRpc3REYXRhIiwiYXJ0aXN0SWQiLCJjcmVhdGVBcnRpc3QiLCJnZXRVc2VyUHJvZmlsZUJ5VXNlcm5hbWUiLCJmaW5kVXNlckJ5VXNlcm5hbWUiLCJFcnJvciIsInVzZXJQcm9maWxlIiwiZmluZFVzZXJQcm9maWxlQnlSb2xlIiwidXBkYXRlVXNlclByb2ZpbGUiLCJ1cGRhdGVEYXRhIiwidXBkYXRlZFByb2ZpbGUiLCJkZWxldGVVc2VyIiwiZ2V0QWxsVXNlcnMiLCJnZXRBbGxVc2Vyc0J5Um9sZSIsInRvZ2dsZVVzZXJTdGF0dXMiLCJ1c2VySWQiLCJpc0FjdGl2ZSIsInVwZGF0ZVVzZXJTdGF0dXNCeUlkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZXJTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpO1xyXG5jb25zdCBVc2VyUmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL3JlcG9zaXRvcmllcy91c2VyUmVwb3NpdG9yeScpO1xyXG5jb25zdCBub2RlbWFpbGVyID0gcmVxdWlyZShcIm5vZGVtYWlsZXJcIik7XHJcbmNsYXNzIFVzZXJTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gbmV3IFVzZXJSZXBvc2l0b3J5KCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgYXN5bmMgc2VuZEVtYWlsKGVtYWlsLCBmdWxsTmFtZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XHJcbiAgICAgICAgc2VydmljZTogXCJnbWFpbFwiLFxyXG4gICAgICAgIGF1dGg6IHtcclxuICAgICAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkVNQUlMX1VTRVIsIFxyXG4gICAgICAgICAgcGFzczogcHJvY2Vzcy5lbnYuRU1BSUxfUEFTUywgXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICBmcm9tOiBwcm9jZXNzLmVudi5FTUFJTF9VU0VSLFxyXG4gICAgICAgIHRvOiBlbWFpbCxcclxuICAgICAgICBzdWJqZWN0OiBcIkFjY291bnQgQ3JlYXRlZCBTdWNjZXNzZnVsbHlcIixcclxuICAgICAgICB0ZXh0OiBgSGVsbG8gJHtmdWxsTmFtZX0sXFxuXFxuWW91ciBhY2NvdW50IGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVxcblxcbkVudGVyIHJhbmRvbSBwYXNzd29yZCBhbmQgbG9naW4gdG8gY2hhbmdlIHRoZSBwYXNzd29yZC5cXG5cXG5CZXN0IFJlZ2FyZHMsXFxuUk1TLmAsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiRW1haWwgc2VudCBzdWNjZXNzZnVsbHlcIik7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgZW1haWw6XCIsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gQnVzaW5lc3MgbG9naWMgZm9yIGNyZWF0aW5nIGEgdXNlclxyXG4gIGFzeW5jIGNyZWF0ZVVzZXIodXNlckRhdGEpIHtcclxuICBcclxuICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnJlc3QgfSA9IHVzZXJEYXRhO1xyXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApO1xyXG4gICAgY29uc3QgdXNlckRhdGFXaXRoSGFzaGVkUGFzc3dvcmQgPSB7IC4uLnJlc3QsIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCB9O1xyXG5cclxuICAgIGxldCBuZXdVc2VyPWF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuY3JlYXRlVXNlcih1c2VyRGF0YVdpdGhIYXNoZWRQYXNzd29yZCk7XHJcbiBcclxuXHJcblxyXG4gICAgLy8gU2F2ZSB0byBNYW5hZ2VyIG9yIEFydGlzdCBjb2xsZWN0aW9uIGJhc2VkIG9uIHJvbGUgYnkgY2FsbGluZyByZXBvc2l0b3J5IG1ldGhvZHNcclxuICAgIGlmIChuZXdVc2VyLnJvbGUgPT09ICdNYW5hZ2VyJykge1xyXG4gICAgICBjb25zdCBtYW5hZ2VyRGF0YSA9IHsgbWFuYWdlcklkOiBuZXdVc2VyLl9pZCwgdXNlcm5hbWU6bmV3VXNlci51c2VybmFtZSwgZW1haWw6bmV3VXNlci5lbWFpbCwgLi4ucmVzdCB9O1xyXG4gICAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZU1hbmFnZXIobWFuYWdlckRhdGEpO1xyXG4gICAgfSBlbHNlIGlmIChuZXdVc2VyLnJvbGUgPT09ICdBcnRpc3QnKSB7XHJcbiAgXHJcbiAgICAgIGNvbnN0IGFydGlzdERhdGEgPSB7IGFydGlzdElkOiBuZXdVc2VyLl9pZCwgdXNlcm5hbWU6bmV3VXNlci51c2VybmFtZSwgZW1haWw6bmV3VXNlci5lbWFpbCwgLi4ucmVzdCB9O1xyXG4gICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZUFydGlzdChhcnRpc3REYXRhKTtcclxuICAgIH1cclxuICAgIGF3YWl0IHRoaXMuc2VuZEVtYWlsKG5ld1VzZXIuZW1haWwsIG5ld1VzZXIudXNlcm5hbWUpO1xyXG5cclxuICAgIHJldHVybiBuZXdVc2VyO1xyXG4gIH1cclxuXHJcbiAgLy8gQnVzaW5lc3MgbG9naWMgZm9yIGdldHRpbmcgdXNlciBwcm9maWxlXHJcbiAgYXN5bmMgZ2V0VXNlclByb2ZpbGVCeVVzZXJuYW1lKHVzZXJuYW1lKSB7XHJcbiAgICBjb25zb2xlLmxvZyh1c2VybmFtZSxcImluc2lkZSB1c2VyU2VydmljZSEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhXCIpO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZFVzZXJCeVVzZXJuYW1lKHVzZXJuYW1lKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlclByb2ZpbGUgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRVc2VyUHJvZmlsZUJ5Um9sZSh1c2VyLl9pZCwgdXNlci5yb2xlKTtcclxuICAgIGlmICghdXNlclByb2ZpbGUpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3VzZXIucm9sZX0gZGV0YWlscyBub3QgZm91bmRgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXNlclByb2ZpbGU7XHJcbiAgfVxyXG5cclxuICAvLyBCdXNpbmVzcyBsb2dpYyBmb3IgdXBkYXRpbmcgdXNlciBkZXRhaWxzXHJcbiAgYXN5bmMgdXBkYXRlVXNlclByb2ZpbGUodXNlcm5hbWUsIHVwZGF0ZURhdGEpIHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRVc2VyQnlVc2VybmFtZSh1c2VybmFtZSk7XHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVwZGF0ZWRQcm9maWxlID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS51cGRhdGVVc2VyUHJvZmlsZSh1c2VyLl9pZCwgdXNlci5yb2xlLCB1cGRhdGVEYXRhKTtcclxuICAgIGlmICghdXBkYXRlZFByb2ZpbGUpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3VzZXIucm9sZX0gZGV0YWlscyBub3QgZm91bmRgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXBkYXRlZFByb2ZpbGU7XHJcbiAgfVxyXG5cclxuICAvLyBCdXNpbmVzcyBsb2dpYyBmb3IgZGVsZXRpbmcgYSB1c2VyXHJcbiAgYXN5bmMgZGVsZXRlVXNlcih1c2VybmFtZSkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZFVzZXJCeVVzZXJuYW1lKHVzZXJuYW1lKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5kZWxldGVVc2VyKHVzZXIuX2lkLCB1c2VyLnJvbGUpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvLyBCdXNpbmVzcyBsb2dpYyBmb3IgZ2V0dGluZyBhbGwgdXNlcnMgYnkgcm9sZVxyXG4gIGFzeW5jIGdldEFsbFVzZXJzKHJvbGUpIHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmdldEFsbFVzZXJzQnlSb2xlKHJvbGUpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdG9nZ2xlVXNlclN0YXR1cyh1c2VySWQsIGlzQWN0aXZlKSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS51cGRhdGVVc2VyU3RhdHVzQnlJZCh1c2VySWQsIGlzQWN0aXZlKTtcclxuICAgIFxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFVzZXJTZXJ2aWNlO1xyXG4iXSwibWFwcGluZ3MiOiJvaE5BZVk7QUFBQUEsY0FBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxjQUFBLEdBZlosS0FBTSxDQUFBRSxNQUFNLEVBQUFGLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQ2hDLEtBQU0sQ0FBQUMsY0FBYyxFQUFBTCxjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLEVBQ2hFLEtBQU0sQ0FBQUUsVUFBVSxFQUFBTixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUN4QyxLQUFNLENBQUFHLFdBQVksQ0FFaEJDLFdBQVdBLENBQUEsQ0FBRyxDQUFBUixjQUFBLEdBQUFTLENBQUEsTUFBQVQsY0FBQSxHQUFBRyxDQUFBLE1BQ1osSUFBSSxDQUFDTyxjQUFjLENBQUcsR0FBSSxDQUFBTCxjQUFjLENBQUMsQ0FBQyxDQUM1QyxDQUdBLEtBQU0sQ0FBQU0sU0FBU0EsQ0FBQ0MsS0FBSyxDQUFFQyxRQUFRLENBQUUsQ0FBQWIsY0FBQSxHQUFBUyxDQUFBLE1BQUFULGNB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LENBRUE7QUFDQSxLQUFNLENBQUFDLFVBQVVBLENBQUNiLFFBQVEsQ0FBRSxDQUFBOUMsY0FBQSxHQUFBUyxDQUFBLE1BQ3pCLEtBQU0sQ0FBQVMsSUFBSSxFQUFBbEIsY0FBQSxHQUFBRyxDQUFBLE9BQUcsS0FBTSxLQUFJLENBQUNPLGNBQWMsQ0FBQzBDLGtCQUFrQixDQUFDTixRQUFRLENBQUMsRUFBQzlDLGNBQUEsR0FBQUcsQ0FBQSxPQUNwRSxHQUFJLENBQUNlLElBQUksQ0FBRSxDQUFBbEIsY0FBQSxHQUFBMEMsQ0FBQSxTQUFBMUMsY0FBQSxHQUFBRyxDQUFBLE9BQ1QsS0FBTSxJQUFJLENBQUFrRCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FDbkMsQ0FBQyxLQUFBckQsY0FBQSxHQUFBMEMsQ0FBQSxVQUFBMUMsY0FBQSxHQUFBRyxDQUFBLE9BRUQsS0FBTSxLQUFJLENBQUNPLGNBQWMsQ0FBQ2lELFVBQVUsQ0FBQ3pDLElBQUksQ0FBQzJCLEdBQUcsQ0FBRTNCLElBQUksQ0FBQ3VCLElBQUksQ0FBQyxDQUFDekMsY0FBQSxHQUFBRyxDQUFBLE9BQzFELE1BQU8sS0FBSSxDQUNiLENBRUE7QUFDQSxLQUFNLENBQUF5RCxXQUFXQSxDQUFDbkIsSUFBSSxDQUFFLENBQUF6QyxjQUFBLEdBQUFTLENBQUEsTUFBQVQsY0FBQSxHQUFBRyxDQUFBLE9BQ3RCLE1BQU8sTUFBTSxLQUFJLENBQUNPLGNBQWMsQ0FBQ21ELGlCQUFpQixDQUFDcEIsSUFBSSxDQUFDLENBQzFELENBRUEsS0FBTSxDQUFBcUIsZ0JBQWdCQSxDQUFDQyxNQUFNLENBQUVDLFFBQVEsQ0FBRSxDQUFBaEUsY0FBQSxHQUFBUyxDQUFBLE1BQ3ZDLEtBQU0sQ0FBQVMsSUFBSSxFQUFBbEIsY0FBQSxHQUFBRyxDQUFBLE9BQUcsS0FBTSxLQUFJLENBQUNPLGNBQWMsQ0FBQ3VELG9CQUFvQixDQUFDRixNQUFNLENBQUVDLFFBQVEsQ0FBQyxFQUFDaEUsY0FBQSxHQUFBRyxDQUFBLE9BRTlFLEdBQUksQ0FBQ2UsSUFBSSxDQUFFLENBQUFsQixjQUFBLEdBQUEwQyxDQUFBLFNBQUExQyxjQUFBLEdBQUFHLENBQUEsT0FDVCxLQUFNLElBQUksQ0FBQWtELEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUNuQyxDQUFDLEtBQUFyRCxjQUFBLEdBQUEwQyxDQUFBLFVBQUExQyxjQUFBLEdBQUFHLENBQUEsT0FFRCxNQUFPLENBQUFlLElBQUksQ0FDYixDQUVGLENBQUNsQixjQUFBLEdBQUFHLENBQUEsT0FFRCtELE1BQU0sQ0FBQ0MsT0FBTyxDQUFHNUQsV0FBVyIsImlnbm9yZUxpc3QiOltdfQ==