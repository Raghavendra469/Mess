function cov_1zomjen12w(){var path="C:\\capstone on friday\\Mess\\RMS\\server\\middleware\\authMiddleware.js";var hash="926c8e67de73be8b98fd9d36a109a8815527e18d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\capstone on friday\\Mess\\RMS\\server\\middleware\\authMiddleware.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:35}},"1":{start:{line:2,column:13},end:{line:2,column:46}},"2":{start:{line:4,column:19},end:{line:33,column:1}},"3":{start:{line:5,column:4},end:{line:32,column:5}},"4":{start:{line:7,column:8},end:{line:9,column:9}},"5":{start:{line:8,column:12},end:{line:8,column:103}},"6":{start:{line:11,column:22},end:{line:11,column:61}},"7":{start:{line:12,column:8},end:{line:14,column:9}},"8":{start:{line:13,column:12},end:{line:13,column:89}},"9":{start:{line:17,column:24},end:{line:17,column:62}},"10":{start:{line:21,column:21},end:{line:21,column:53}},"11":{start:{line:22,column:8},end:{line:24,column:9}},"12":{start:{line:23,column:12},end:{line:23,column:85}},"13":{start:{line:26,column:8},end:{line:26,column:24}},"14":{start:{line:27,column:8},end:{line:27,column:36}},"15":{start:{line:28,column:8},end:{line:28,column:15}},"16":{start:{line:30,column:8},end:{line:30,column:63}},"17":{start:{line:31,column:8},end:{line:31,column:88}},"18":{start:{line:35,column:0},end:{line:35,column:32}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:19},end:{line:4,column:20}},loc:{start:{line:4,column:45},end:{line:33,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:7,column:8},end:{line:9,column:9}},type:"if",locations:[{start:{line:7,column:8},end:{line:9,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:7},"1":{loc:{start:{line:12,column:8},end:{line:14,column:9}},type:"if",locations:[{start:{line:12,column:8},end:{line:14,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:12},"2":{loc:{start:{line:22,column:8},end:{line:24,column:9}},type:"if",locations:[{start:{line:22,column:8},end:{line:24,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"926c8e67de73be8b98fd9d36a109a8815527e18d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1zomjen12w=function(){return actualCoverage;};}return actualCoverage;}cov_1zomjen12w();const jwt=(cov_1zomjen12w().s[0]++,require('jsonwebtoken'));const User=(cov_1zomjen12w().s[1]++,require('../models/userModel.js'));cov_1zomjen12w().s[2]++;const verifyUser=async(req,res,next)=>{cov_1zomjen12w().f[0]++;cov_1zomjen12w().s[3]++;try{cov_1zomjen12w().s[4]++;// Check if Authorization header exists
if(!req.headers.authorization){cov_1zomjen12w().b[0][0]++;cov_1zomjen12w().s[5]++;return res.status(401).json({success:false,error:"No authorization header provided"});}else{cov_1zomjen12w().b[0][1]++;}const token=(cov_1zomjen12w().s[6]++,req.headers.authorization.split(' ')[1]);cov_1zomjen12w().s[7]++;if(!token){cov_1zomjen12w().b[1][0]++;cov_1zomjen12w().s[8]++;return res.status(401).json({success:false,error:"Token not provided"});}else{cov_1zomjen12w().b[1][1]++;}// Verify token
const decoded=(cov_1zomjen12w().s[9]++,jwt.verify(token,process.env.JWT_KEY));// Find user
// const user = await User.findById(decoded._id).select('-password');
const user=(cov_1zomjen12w().s[10]++,await User.findById(decoded._id));cov_1zomjen12w().s[11]++;if(!user){cov_1zomjen12w().b[2][0]++;cov_1zomjen12w().s[12]++;return res.status(404).json({success:false,error:"User not found"});}else{cov_1zomjen12w().b[2][1]++;}cov_1zomjen12w().s[13]++;req.user=user;cov_1zomjen12w().s[14]++;console.log("user verified");cov_1zomjen12w().s[15]++;next();}catch(error){cov_1zomjen12w().s[16]++;console.error("Auth Middleware Error:",error.message);cov_1zomjen12w().s[17]++;return res.status(500).json({success:false,error:"Authentication failed"});}};cov_1zomjen12w().s[18]++;module.exports={verifyUser};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXpvbWplbjEydyIsImFjdHVhbENvdmVyYWdlIiwiand0IiwicyIsInJlcXVpcmUiLCJVc2VyIiwidmVyaWZ5VXNlciIsInJlcSIsInJlcyIsIm5leHQiLCJmIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJiIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsInRva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9LRVkiLCJ1c2VyIiwiZmluZEJ5SWQiLCJfaWQiLCJjb25zb2xlIiwibG9nIiwibWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhdXRoTWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcclxuY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy91c2VyTW9kZWwuanMnKTtcclxuXHJcbmNvbnN0IHZlcmlmeVVzZXIgPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgQXV0aG9yaXphdGlvbiBoZWFkZXIgZXhpc3RzXHJcbiAgICAgICAgaWYgKCFyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhdXRob3JpemF0aW9uIGhlYWRlciBwcm92aWRlZFwiIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uLnNwbGl0KCcgJylbMV07XHJcbiAgICAgICAgaWYgKCF0b2tlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVG9rZW4gbm90IHByb3ZpZGVkXCIgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWZXJpZnkgdG9rZW5cclxuICAgICAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX0tFWSk7XHJcblxyXG4gICAgICAgIC8vIEZpbmQgdXNlclxyXG4gICAgICAgIC8vIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGRlY29kZWQuX2lkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGRlY29kZWQuX2lkKTtcclxuICAgICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVzZXIgbm90IGZvdW5kXCIgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXEudXNlciA9IHVzZXI7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJ1c2VyIHZlcmlmaWVkXCIpXHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiQXV0aCBNaWRkbGV3YXJlIEVycm9yOlwiLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQXV0aGVudGljYXRpb24gZmFpbGVkXCIgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgdmVyaWZ5VXNlciB9O1xyXG4iXSwibWFwcGluZ3MiOiJnbEZBZVk7QUFBQUEsY0FBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxjQUFBLEdBZlosS0FBTSxDQUFBRSxHQUFHLEVBQUFGLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxP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